<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Dashboard</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- Google Fonts: Poppins -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f8f9fa;
        }
        
        /* Smooth badge styling */
        .badge {
            display: inline-block;
            padding: 0.25em 0.8em;
            font-size: 0.75rem;
            font-weight: 700;
            line-height: 1;
            text-align: center;
            white-space: nowrap;
            vertical-align: baseline;
            border-radius: 0.5rem;
        }

        /* Animation for loading */
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1; 
        }
        ::-webkit-scrollbar-thumb {
            background: #ccc; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #aaa; 
        }
    </style>
</head>
<body class="text-gray-800">

    <!-- Navigation / Header -->
    <nav class="bg-white shadow-sm sticky top-0 z-50">
        <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16 items-center">
                <div class="flex items-center gap-3">
                    <i class="fa-solid fa-graduation-cap text-2xl text-indigo-600"></i>
                    <h1 class="text-xl font-bold tracking-tight text-gray-900">Student<span class="text-indigo-600">Hub</span></h1>
                </div>
                <div class="text-sm text-gray-500 hidden sm:block" id="last-updated">
                    <!-- Date will be injected here -->
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        
        <!-- Stats Overview Cards -->
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
            <!-- Card 1 -->
            <div class="bg-white overflow-hidden shadow rounded-xl p-5 border-l-4 border-blue-500">
                <dt class="text-sm font-medium text-gray-500 truncate">Total Tasks</dt>
                <dd class="mt-1 text-3xl font-semibold text-gray-900" id="stat-total">0</dd>
            </div>
            <!-- Card 2 -->
            <div class="bg-white overflow-hidden shadow rounded-xl p-5 border-l-4 border-yellow-400">
                <dt class="text-sm font-medium text-gray-500 truncate">Upcoming (7 Days)</dt>
                <dd class="mt-1 text-3xl font-semibold text-gray-900" id="stat-upcoming">0</dd>
            </div>
            <!-- Card 3 -->
            <div class="bg-white overflow-hidden shadow rounded-xl p-5 border-l-4 border-red-500">
                <dt class="text-sm font-medium text-gray-500 truncate">Overdue</dt>
                <dd class="mt-1 text-3xl font-semibold text-gray-900" id="stat-overdue">0</dd>
            </div>
            <!-- Card 4 -->
            <div class="bg-white overflow-hidden shadow rounded-xl p-5 border-l-4 border-green-500">
                <dt class="text-sm font-medium text-gray-500 truncate">Completed</dt>
                <dd class="mt-1 text-3xl font-semibold text-gray-900" id="stat-completed">0</dd>
            </div>
        </div>

        <!-- Search & Filter -->
        <div class="flex flex-col sm:flex-row justify-between items-center mb-6 gap-4">
            <div class="relative w-full sm:w-96">
                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                    <i class="fa-solid fa-search text-gray-400"></i>
                </div>
                <input type="text" id="search-input" class="block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg leading-5 bg-white placeholder-gray-500 focus:outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 sm:text-sm" placeholder="Search assignments...">
            </div>
            
            <div class="flex gap-2 w-full sm:w-auto">
                <select id="filter-class" class="block w-full py-2 px-3 border border-gray-300 bg-white rounded-lg shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                    <option value="All">All Classes</option>
                    <!-- Options will be injected via JS -->
                </select>
            </div>
        </div>

        <!-- Loading Spinner -->
        <div id="loader" class="text-center py-20">
            <div class="inline-block animate-spin rounded-full h-12 w-12 border-t-4 border-b-4 border-indigo-600"></div>
            <p class="mt-4 text-gray-500">Fetching your latest schedule...</p>
        </div>

        <!-- Assignment List (Responsive Grid) -->
        <div id="assignment-container" class="grid gap-4 hidden">
            <!-- Cards will be injected here via JS -->
        </div>

        <!-- Empty State (Hidden by default) -->
        <div id="empty-state" class="hidden text-center py-20">
            <i class="fa-regular fa-clipboard text-6xl text-gray-300 mb-4"></i>
            <h3 class="text-lg font-medium text-gray-900">No assignments found</h3>
            <p class="text-gray-500">You're all caught up! Or check your filters.</p>
        </div>

    </main>

    <footer class="bg-white border-t border-gray-200 mt-12">
        <div class="max-w-6xl mx-auto px-4 py-6 sm:px-6 lg:px-8">
            <p class="text-center text-sm text-gray-500">
                &copy; 2025 StudentHub. Managed via Google Sheets.
            </p>
        </div>
    </footer>

    <script>
        // ==========================================
        // âš™ï¸ CONFIGURATION
        // Paste your "Publish to Web" > CSV link here:
        // ==========================================
        const SHEET_CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTzkyidBhfigPvat3WEZFh6IhblU1GPSZIiPAeI27ALZ4yfoxzfHiji3HtczzYHTS-b3d3dj1iYmHSu/pub?gid=0&single=true&output=csv"; 

        // ==========================================
        // ðŸš€ APP LOGIC
        // ==========================================
        
        let allAssignments = [];

        document.addEventListener('DOMContentLoaded', () => {
            if(SHEET_CSV_URL === "YOUR_GOOGLE_SHEET_LINK_HERE") {
                alert("Please edit the index.html file and add your Google Sheet CSV link!");
                return;
            }
            fetchData();
            
            // Event Listeners for Search/Filter
            document.getElementById('search-input').addEventListener('input', filterData);
            document.getElementById('filter-class').addEventListener('change', filterData);
        });

        async function fetchData() {
            try {
                const response = await fetch(SHEET_CSV_URL);
                const data = await response.text();
                
                // Parse CSV
                const rows = data.split('\n').map(row => row.split(','));
                const headers = rows[0].map(h => h.trim().toLowerCase()); // Normalize headers
                
                // Map CSV rows to objects based on your specific column layout
                // ADJUST INDICES IF YOUR COLUMNS ARE DIFFERENT
                // Assuming: [0]Class, [1]Assignment, [2]Description, [3]Priority, [4]Date, [5]DaysLeft, [6]Marks
                // Note: CSV parsing by simple split has issues with commas in text. 
                // For robust parsing, we use a regex approach below.
                
                allAssignments = parseCSV(data);
                
                populateClassFilter();
                calculateStats();
                renderAssignments(allAssignments);
                
                document.getElementById('loader').classList.add('hidden');
                document.getElementById('assignment-container').classList.remove('hidden');
                document.getElementById('last-updated').innerText = `Last synced: ${new Date().toLocaleTimeString()}`;

            } catch (error) {
                console.error('Error fetching data:', error);
                document.getElementById('loader').innerHTML = `<p class="text-red-500">Error loading data. Check your CSV link.</p>`;
            }
        }

        // Simple CSV Parser that handles quoted strings (like "Project: A, B, and C")
        function parseCSV(text) {
            const lines = text.split(/\r\n|\n/);
            const headers = lines[0].split(',');
            const result = [];

            for (let i = 1; i < lines.length; i++) {
                if (!lines[i]) continue;
                
                // Regex to split by comma but ignore commas inside quotes
                const obj = {};
                const currentline = lines[i].match(/(".*?"|[^",\s]+)(?=\s*,|\s*$)/g) || [];
                
                // Map specific columns based on your screenshot layout:
                // Note: We map by Index because header names might change
                // Index 0: Class Name (B)
                // Index 1: Assignment (C)
                // Index 2: Description (D)
                // Index 3: Priority (E)
                // Index 4: Date (F)
                // Index 5: Days Left (G)
                
                // Handle potential offset if you added a checkbox column (Shift indices by +1 if so)
                // Let's assume standard layout from image:
                const rowData = lines[i].split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/); // Better Split regex

                if(rowData.length < 4) continue; // Skip empty rows

                obj.className = clean(rowData[0]); // Column A (or B if hidden)
                obj.title = clean(rowData[1]);     // Column B
                obj.desc = clean(rowData[2]);      // Column C
                obj.priority = clean(rowData[3]);  // Column D
                obj.date = clean(rowData[4]);      // Column E
                obj.daysLeft = parseInt(clean(rowData[5])) || 0; // Column F
                obj.marks = clean(rowData[6]);     // Column G

                result.push(obj);
            }
            return result;
        }

        function clean(str) {
            return str ? str.replace(/^"|"$/g, '').trim() : '';
        }

        function calculateStats() {
            const total = allAssignments.length;
            const upcoming = allAssignments.filter(a => a.daysLeft <= 7 && a.daysLeft >= 0).length;
            const overdue = allAssignments.filter(a => a.daysLeft < 0).length;
            // Assuming "Completed" logic relies on text or manual removal, 
            // for now we'll just count total tasks as "Active"
            
            document.getElementById('stat-total').innerText = total;
            document.getElementById('stat-upcoming').innerText = upcoming;
            document.getElementById('stat-overdue').innerText = overdue;
            document.getElementById('stat-completed').innerText = "-"; // Needs checkbox logic to work
        }

        function populateClassFilter() {
            const classes = [...new Set(allAssignments.map(item => item.className))].filter(c => c);
            const select = document.getElementById('filter-class');
            classes.forEach(c => {
                const option = document.createElement('option');
                option.value = c;
                option.innerText = c;
                select.appendChild(option);
            });
        }

        function filterData() {
            const searchTerm = document.getElementById('search-input').value.toLowerCase();
            const classFilter = document.getElementById('filter-class').value;

            const filtered = allAssignments.filter(item => {
                const matchesSearch = (item.title.toLowerCase().includes(searchTerm) || 
                                     item.className.toLowerCase().includes(searchTerm));
                const matchesClass = classFilter === "All" || item.className === classFilter;
                return matchesSearch && matchesClass;
            });

            renderAssignments(filtered);
        }

        function renderAssignments(data) {
            const container = document.getElementById('assignment-container');
            container.innerHTML = '';

            if (data.length === 0) {
                document.getElementById('empty-state').classList.remove('hidden');
                return;
            } else {
                document.getElementById('empty-state').classList.add('hidden');
            }

            data.forEach(item => {
                // Priority Colors
                let priorityClass = "bg-gray-100 text-gray-800";
                if(item.priority.toLowerCase().includes("high")) priorityClass = "bg-red-100 text-red-800";
                if(item.priority.toLowerCase().includes("medium")) priorityClass = "bg-yellow-100 text-yellow-800";
                if(item.priority.toLowerCase().includes("low")) priorityClass = "bg-green-100 text-green-800";

                // Days Left Logic
                let daysColor = "text-gray-600";
                let daysText = `${item.daysLeft} Days Left`;
                if (item.daysLeft < 0) {
                    daysColor = "text-red-600 font-bold";
                    daysText = `Overdue by ${Math.abs(item.daysLeft)} Days`;
                } else if (item.daysLeft <= 3) {
                    daysColor = "text-orange-600 font-bold";
                }

                const card = document.createElement('div');
                card.className = "bg-white rounded-lg shadow hover:shadow-md transition duration-200 p-5 border border-gray-100 flex flex-col sm:flex-row gap-4 justify-between items-start sm:items-center fade-in";
                
                card.innerHTML = `
                    <div class="flex-1">
                        <div class="flex items-center gap-2 mb-1">
                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-indigo-100 text-indigo-800">
                                ${item.className}
                            </span>
                            <span class="badge ${priorityClass}">
                                ${item.priority}
                            </span>
                        </div>
                        <h4 class="text-lg font-semibold text-gray-900">${item.title}</h4>
                        <p class="text-sm text-gray-500 mt-1 line-clamp-2">${item.desc}</p>
                    </div>
                    
                    <div class="flex items-center gap-6 w-full sm:w-auto justify-between sm:justify-end mt-2 sm:mt-0 border-t sm:border-t-0 pt-3 sm:pt-0">
                        <div class="text-right">
                            <p class="text-xs text-gray-400 uppercase font-semibold">Due Date</p>
                            <p class="font-medium text-gray-900">${item.date}</p>
                        </div>
                        <div class="text-right w-24">
                            <p class="text-xs ${daysColor} uppercase font-semibold">${daysText}</p>
                        </div>
                    </div>
                `;
                container.appendChild(card);
            });
        }
    </script>
</body>
</html>
